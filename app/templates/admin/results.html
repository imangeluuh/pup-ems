{% extends 'admin/base.html' %}

{% block head %}
    <title>Extension Programs Budget</title>
    <!--Regular Datatables CSS-->
	<link href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" rel="stylesheet">
	<!--Responsive Extension Datatables CSS-->
	<link href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {'packages':['corechart']});

    </script>

{% endblock %}

{% block content %}
        <!--Container-->
        <div class="container w-full flex justify-center md:w-4/5 xl:w-3/5  mx-auto px-2">
            <!-- Card -->
            <div class="p-8 mt-6 lg:mt-0 rounded-lg shadow w-1/2 bg-white">
                
                <div class="header">
                    <h1>{{ survey.SurveyName }}</h1>
                    <h2>{{ survey.Activity.ActivityName }}</h2>
                </div>
                <div class="content">
        
                    <h2 class="content-subhead"><i class="fa fa-pie-chart"></i> Survey Results</h2>
        
                    {% if (survey.State == 2 and current_user.Role.RoleId == 1) or survey.State == 0 %}
        
                    <br>
                    <form class="pure-form pure-form-stacked">
                        <fieldset>
                            {% for question in questions %}
                            <legend>{{ question.Text }} {% if question.Required %}<span class="pure-form-message-inline">* required</span>{% endif %}</legend>
                                <p><i>Total Responses:</i> {{ responses|selectattr("QuestionId", "equalto", question.QuestionId)|list|length }}</p>
        
                                {% if responses|selectattr("QuestionId", "equalto", question.QuestionId)|list|length > 0 %}
                                    {% if question.Type == 1 %}
                                        <div id="{{ question.QuestionId }}"></div>
                                        <script> var data{{ question.QuestionId }} = [['Option', 'Responses']];</script>
                                        {% for option in question.responsesList() %}
                                            {% for response in responses if response.QuestionId == question.QuestionId and response.Num == loop.index  %}
                                                {% if loop.last %} <script>data{{ question.QuestionId }}.push(["{{ option }}", {{ loop.index }}]);</script> {% endif %}
                                            {% else %}
                                                <script>data{{ question.QuestionId }}.push(["{{ option }}", 0]);</script>
                                            {% endfor %}
                                        {% endfor %}
                                        <script>
                                            google.charts.setOnLoadCallback(drawChart{{ question.QuestionId }});
                                            function drawChart{{ question.QuestionId }}() {
                                                var chartData = google.visualization.arrayToDataTable(data{{ question.QuestionId }});
                                                var chart = new google.visualization.PieChart(document.getElementById({{ question.QuestionId }}));
                                                chart.draw(chartData, {sliceVisibilityThreshold: 0, chartArea:{left:0,top:20,width:'75%',height:'100%'}, legend: {alignment: 'center'}});
                                            }
                                        </script>
        
                                    {% else %}
                                        <table class="pure-table-striped" style="width:100%;">
                                            <tbody>
                                                {% for response in responses if response.QuestionId == question.QuestionId %}
                                                    <tr><td>{{ response.Text }}</td></tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                        <br>
                                    {% endif %}
                                {% else %}
                                    <br>
                                {% endif %}
                            {% endfor %}
                        </fieldset>
                    </form>
        
                   {%else%}
                   <p>Results for this survey are not available yet.</p>
                   {% endif %}
                   <br>
                   <a href="/">Click here to return to your Dashboard.</a>
        
                </div>

            </div>
            <!-- /Card -->
        </div>
	    <!--/container-->
{% endblock %}
